# üõ†Ô∏è Troubleshooting ‚Äì Lab 6: Linux Event Logs for Malware Detection

<br>

### Issue 1: Permission Denied When Accessing Log Files

#### Problem

Attempting to read `/var/log/syslog` or `/var/log/auth.log` results in:

Permission denied

#### Cause

Log files are restricted to `root` and members of the `adm` group.

#### Solution

Use sudo:

```
sudo cat /var/log/syslog
```

Or add user to adm group:

```
sudo usermod -a -G adm $USER
```

Log out and back in to apply group changes.

---

### Issue 2: No Suspicious Entries Detected by Python Script

#### Problem

`log_parser.py` or `anomaly_detector.py` returns:

`
Suspicious entries: 0
Risk level: LOW
`

#### Cause

No recent failed logins or suspicious activity in logs.

#### Solution

Generate test security events:

```
sudo su - invaliduser 2>/dev/null || true
sudo logger "Test malware detection event"
```

Re-run analysis:

```
python3 anomaly_detector.py
```

---

### Issue 3: Real-Time Monitor Shows No Alerts

#### Problem

`realtime_monitor.py` runs but no `[ALERT]` messages appear.

#### Possible Causes

* Monitoring wrong log file
* No matching patterns triggered
* No new events generated during monitoring window

#### Solutions

1. Verify correct file:

```
ls -l /var/log/auth.log
```

2. Generate test event in another terminal:

```
sudo su - testuser 2>/dev/null || true
```

3. Confirm regex pattern works:

```
grep -Ei "failed password|invalid user" /var/log/auth.log
```

---

### Issue 4: Python Script Cannot Open Log File

#### Problem

`
FileNotFoundError: /var/log/syslog
`

#### Cause

Incorrect file path or minimal container environment without traditional syslog.

#### Solution

Check available logs:

```
ls /var/log/
```

If system uses journald only:

```
sudo journalctl > journal_logs.txt
```

Modify Python script to read exported file instead.

---

### Issue 5: Regex Patterns Not Matching Expected Entries

#### Problem

Patterns like `failed password` are not detected.

#### Cause

Case sensitivity or log format differences.

#### Solution

Test pattern manually:

```
grep -i "failed password" /var/log/auth.log
```

Ensure Python uses lowercase comparison:

```
if re.search(pattern, message.lower()):
```

---

### Issue 6: analyze_logs.sh Not Executing

#### Problem

```
Permission denied
```

#### Cause

Script not executable.

#### Solution

Make executable:

```
chmod +x analyze_logs.sh
./analyze_logs.sh
```

---

### Issue 7: No Network Events Detected

#### Problem

Network activity file shows zero lines.

#### Cause

No recent network-related syslog entries.

#### Solution

Generate network activity:

```
ping -c 3 8.8.8.8
curl http://example.com
```

Re-run analysis script.

---

### Issue 8: JSON Report Not Generated

#### Problem

`malware_report.json` not found after running anomaly detector.

#### Cause

Script execution error or incorrect working directory.

#### Solution

Run script from lab directory:

```
cd ~/malware_lab
python3 anomaly_detector.py
```

Verify file exists:

```
ls -lh malware_report.json
```

---

### Issue 9: High CPU Usage During Real-Time Monitoring

#### Problem

System performance drops during `tail -f` monitoring.

#### Cause

Continuous polling of large log file.

#### Solution

Reduce monitoring duration:

```
monitor.monitor_logs(duration_minutes=1)
```

Or use more efficient tools like:

```
journalctl -f
```

---

### Issue 10: Unexpected Log Rotation

#### Problem

Logs rotate during monitoring and script stops detecting events.

#### Cause

Log rotation via `logrotate`.

#### Solution

Monitor rotated files:

```
ls /var/log/auth.log*
```

Use journald for persistent monitoring:

```
journalctl -f
```

---

### üîç Advanced Debugging Commands

Useful commands for deeper investigation:

```
sudo journalctl -xe
sudo systemctl status rsyslog
sudo systemctl status systemd-journald
sudo tail -f /var/log/syslog
sudo tail -f /var/log/auth.log
```

---

# ‚úÖ Validation Checklist

- ‚úî Log files accessible
- ‚úî Suspicious events successfully generated
- ‚úî Bash analysis script executed
- ‚úî Python parser detected suspicious entries
- ‚úî Anomaly detection produced risk assessment
- ‚úî JSON report generated
- ‚úî Real-time alerts triggered

---

# üéØ SOC Perspective

If detection fails in real environments:

* Validate log ingestion pipeline
* Confirm time synchronization (NTP)
* Check log retention policies
* Ensure correct parsing format
* Verify correlation rules
