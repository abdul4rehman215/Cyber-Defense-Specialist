#!/usr/bin/env python3

import subprocess
import re
import time

class RealTimeMonitor:
    def __init__(self):
        self.alert_patterns = [
            r'failed password',
            r'invalid user',
            r'sudo.*root'
        ]

    def monitor_logs(self, duration_minutes=2):
        end_time = time.time() + (duration_minutes * 60)
        proc = subprocess.Popen(
            ["tail", "-f", "/var/log/auth.log"],
            stdout=subprocess.PIPE,
            text=True
        )

        try:
            while time.time() < end_time:
                line = proc.stdout.readline()
                for pattern in self.alert_patterns:
                    if re.search(pattern, line.lower()):
                        print("[ALERT]", line.strip())
        except KeyboardInterrupt:
            pass
        finally:
            proc.terminate()
            print("Monitoring finished")

def main():
    monitor = RealTimeMonitor()
    monitor.monitor_logs()

if __name__ == "__main__":
    main()
