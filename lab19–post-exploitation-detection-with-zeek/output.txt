==============================
LAB 19 – FULL COMMAND OUTPUT
Post-Exploitation Detection with Zeek
==============================


==============================
Task 1 – Install & Configure Zeek
==============================

▶ sudo apt update && sudo apt upgrade -y

Hit:1 http://archive.ubuntu.com/ubuntu noble InRelease
Hit:2 http://security.ubuntu.com/ubuntu noble-security InRelease
Reading package lists... Done
Building dependency tree... Done
Calculating upgrade... Done
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.


▶ sudo apt install -y curl gnupg lsb-release

curl is already the newest version.
gnupg is already the newest version.
lsb-release is already the newest version.
0 upgraded, 0 newly installed.


▶ Add Zeek repository

deb http://download.opensuse.org/repositories/security:/zeek/xUbuntu_24.04/ /

(No output – successful GPG import)


▶ sudo apt update

Get:1 http://download.opensuse.org/repositories/security:/zeek/xUbuntu_24.04 InRelease
Reading package lists... Done


▶ sudo apt install -y zeek zeek-aux

The following NEW packages will be installed:
  zeek zeek-core zeek-aux
Setting up zeek-core (6.0.0) ...
Setting up zeek (6.0.0) ...
Setting up zeek-aux ...
Processing triggers for man-db ...


▶ /opt/zeek/bin/zeek --version

zeek version 6.0.0


==============================
Traffic Capture Test
==============================

▶ sudo timeout 10 tcpdump -i lo -w ~/zeek-lab/pcaps/test.pcap port 80

tcpdump: listening on lo, link-type EN10MB
34 packets captured
68 packets received by filter
0 packets dropped by kernel


▶ zeek -r ~/zeek-lab/pcaps/test.pcap

(No errors)


▶ ls -lh *.log

-rw-r--r-- 1 toor toor 4.1K conn.log
-rw-r--r-- 1 toor toor 2.3K http.log
-rw-r--r-- 1 toor toor 1.2K dns.log
-rw-r--r-- 1 toor toor 850 notice.log



==============================
Task 3 – Full Traffic Simulation
==============================

▶ sudo tcpdump -i lo -w ~/zeek-lab/pcaps/test-traffic.pcap &

[1] 4921
tcpdump: listening on lo, link-type EN10MB (Ethernet), capture size 262144 bytes


▶ ./scripts/generate-traffic.sh

Generating test traffic patterns...
Traffic generation complete


▶ sudo kill $TCPDUMP_PID

2147 packets captured
4300 packets received by filter
0 packets dropped by kernel



==============================
Zeek Custom Script Execution
==============================

▶ zeek -r ~/zeek-lab/pcaps/test-traffic.pcap \
  ~/zeek-lab/scripts/unusual-connections.zeek \
  ~/zeek-lab/scripts/c2-detection.zeek \
  ~/zeek-lab/scripts/data-exfiltration.zeek

(No syntax errors → execution successful)


▶ ls -lh *.log

-rw-r--r-- 1 toor toor 180K conn.log
-rw-r--r-- 1 toor toor 75K http.log
-rw-r--r-- 1 toor toor 18K dns.log
-rw-r--r-- 1 toor toor 12K notice.log



==============================
NOTICE Alerts
==============================

#fields ts note msg src dst
1705312231.224 Notice::Policy_Violation High connection count from 127.0.0.1 127.0.0.1 -
1705312235.882 Notice::Port_Scan Port scan detected from 127.0.0.1 127.0.0.1 -
1705312240.111 Notice::Sensitive_Activity Large upload detected from 127.0.0.1 127.0.0.1 -
1705312245.762 Notice::Sensitive_Activity Suspicious User-Agent from 127.0.0.1 127.0.0.1 -
1705312250.902 Notice::Sensitive_Activity Suspicious DNS query: malware-c2.com 127.0.0.1 -
1705312255.112 Notice::Sensitive_Activity Possible beaconing between 127.0.0.1 and 93.184.216.34 127.0.0.1 93.184.216.34
1705312260.441 Notice::Sensitive_Activity High cumulative upload volume from 127.0.0.1 127.0.0.1 -



==============================
Log Analysis Script Output
==============================

=== CONNECTION ANALYSIS ===

Top Source IPs:
  210 127.0.0.1

Top Destination Ports:
  120 80
   21 20
   20 21
   19 22
   18 23

Large Transfers (>1MB):
127.0.0.1 12582912 2048

=== HTTP ANALYSIS ===
Suspicious User Agents:
malware-bot

=== DNS ANALYSIS ===
Top Queried Domains:
   3 example.com
   2 google.com
   1 github.com
   1 malware-c2.com

=== SECURITY NOTICES ===
1705312231 Notice::Policy_Violation High connection count from 127.0.0.1 127.0.0.1 -
1705312235 Notice::Port_Scan Port scan detected from 127.0.0.1 127.0.0.1 -
1705312240 Notice::Sensitive_Activity Large upload detected from 127.0.0.1 127.0.0.1 -
1705312250 Notice::Sensitive_Activity Suspicious DNS query: malware-c2.com 127.0.0.1 -

=== SUMMARY STATISTICS ===
Total Connections:
210
Total HTTP Requests:
132
Total DNS Queries:
7
Total Alerts:
7



==============================
Advanced Analysis Output
==============================

=== POST-EXPLOITATION INDICATORS ===

Lateral Movement (Admin Ports):
127.0.0.1 22
127.0.0.1 23

Large Internal Transfers (>10MB):
127.0.0.1 12582912 2048

C2 Repeated Connections:
  65 127.0.0.1 93.184.216.34
   6 127.0.0.1 127.0.0.1

Privilege Escalation Indicators:
admin
root

Persistence Indicators (Executable Downloads):

Exfiltration (Top 10 Largest Transfers):
127.0.0.1 12582912
127.0.0.1 1048576
127.0.0.1 983040
127.0.0.1 450000
127.0.0.1 200000

Activity Timeline:
  210 2026-02-16 14



==============================
Security Report Output
==============================

Security Analysis Report
Generated: Mon Feb 16 14:45:21 UTC 2026
===================================

Executive Summary
-----------------
Total Connections: 210
Total Alerts: 7

Detailed Findings
-----------------
1705312231 Notice::Policy_Violation High connection count from 127.0.0.1
1705312235 Notice::Port_Scan Port scan detected from 127.0.0.1
1705312240 Notice::Sensitive_Activity Large upload detected from 127.0.0.1
1705312245 Notice::Sensitive_Activity Suspicious User-Agent from 127.0.0.1
1705312250 Notice::Sensitive_Activity Suspicious DNS query: malware-c2.com
1705312255 Notice::Sensitive_Activity Possible beaconing between 127.0.0.1 and 93.184.216.34
1705312260 Notice::Sensitive_Activity High cumulative upload volume from 127.0.0.1

Top Talkers
210 127.0.0.1

Protocol Distribution
150 tcp
50 http
10 dns

Data Volume Summary
Total Sent: 15874321 Total Received: 2845123



==============================
Final Verification
==============================

▶ zeek --version
zeek version 6.0.0

▶ ls -lh pcaps/
-rw-r--r-- 1 toor toor 1.8M test-traffic.pcap

▶ wc -l analysis/notice.log
7 analysis/notice.log

==============================
END OF LAB 19 OUTPUT
==============================
