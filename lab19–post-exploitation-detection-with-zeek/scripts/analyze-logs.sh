#!/bin/bash

cd ~/zeek-lab/analysis || exit

echo "=== CONNECTION ANALYSIS ==="

echo "Top Source IPs:"
zeek-cut id.orig_h < conn.log | sort | uniq -c | sort -nr | head

echo ""
echo "Top Destination Ports:"
zeek-cut id.resp_p < conn.log | sort | uniq -c | sort -nr | head

echo ""
echo "Large Transfers (>1MB):"
zeek-cut id.orig_h orig_bytes resp_bytes < conn.log | \
awk '$2 > 1000000 || $3 > 1000000'

echo ""
echo "=== HTTP ANALYSIS ==="

if [ -f http.log ]; then
    echo "Suspicious User Agents:"
    zeek-cut user_agent < http.log | grep -Ei "malware|bot|evil"
fi

echo ""
echo "=== DNS ANALYSIS ==="

if [ -f dns.log ]; then
    echo "Top Queried Domains:"
    zeek-cut query < dns.log | sort | uniq -c | sort -nr | head
fi

echo ""
echo "=== SECURITY NOTICES ==="

if [ -f notice.log ]; then
    zeek-cut ts note msg src dst < notice.log
fi

echo ""
echo "=== SUMMARY STATISTICS ==="

echo "Total Connections:"
wc -l < conn.log

if [ -f http.log ]; then
    echo "Total HTTP Requests:"
    wc -l < http.log
fi

if [ -f dns.log ]; then
    echo "Total DNS Queries:"
    wc -l < dns.log
fi

if [ -f notice.log ]; then
    echo "Total Alerts:"
    wc -l < notice.log
fi
