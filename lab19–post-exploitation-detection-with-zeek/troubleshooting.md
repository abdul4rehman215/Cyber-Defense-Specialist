# ðŸ›  Troubleshooting â€“ Lab 19 - Post-Exploitation Detection with Zeek

---

## Issue 1: `zeek` Command Not Found

### Problem:
After installation, running `zeek` returns:
`
command not found
`

### Solution:

1ï¸âƒ£ Verify installation:
```
dpkg -l | grep zeek
```

2ï¸âƒ£ Use full path:
```
/opt/zeek/bin/zeek --version
```

3ï¸âƒ£ Add Zeek to PATH:
```
echo 'export PATH=/opt/zeek/bin:$PATH' >> ~/.bashrc
source ~/.bashrc
```

---

## Issue 2: No Logs Generated After Running Zeek

### Problem:
Running:
`
zeek -r test.pcap
`
Produces no log files.

### Solution:

âœ” Verify PCAP exists:
```
ls -lh ~/zeek-lab/pcaps/*.pcap
```

âœ” Ensure PCAP contains traffic:
```
tcpdump -r test.pcap
```

âœ” Validate script syntax:
```
zeek -a script.zeek
```

âœ” Check execution directory:
Logs are generated in the current working directory.

---

## Issue 3: Custom Scripts Do Not Generate NOTICE Alerts

### Possible Causes:

- Threshold values too high
- Traffic volume too low
- Script not loaded during execution

### Solutions:

âœ” Lower threshold values for testing  
âœ” Add debug statements:
```
print fmt("Debug: %s", variable);
```
âœ” Confirm script loading:
```
zeek -r file.pcap script.zeek
```
âœ” Check notice.log:
```
ls -lh notice.log
```

---

## Issue 4: `zeek-cut` Command Not Found

### Problem:
`
zeek-cut: command not found
`

### Solution:

Install auxiliary tools:
```
sudo apt install zeek-aux
```

Alternative parsing:
Use `awk` on tab-separated logs.

---

## Issue 5: Permission Denied When Capturing Traffic

### Problem:
`
tcpdump: permission denied
`

### Solution:

âœ” Use sudo:
```
sudo tcpdump -i lo -w file.pcap
```

âœ” Add user to packet capture group:
```
sudo usermod -aG wireshark $USER
```
Reboot after changes.

---

## Issue 6: No Traffic Detected on Loopback Interface

### Solution:

âœ” Verify traffic generation script executed  
âœ” Test manually:
```
curl http://example.com
```
âœ” Confirm capture interface:
```
ip addr
```

Ensure correct interface (lo).

---

## Issue 7: NOTICE Alerts Exist but No Detection in Analysis Script

### Solution:

âœ” Confirm analysis script is running inside `analysis/` directory  
âœ” Ensure log filenames match expected names  
âœ” Verify notice.log format using:
```
head notice.log
```

---

# ðŸ”Ž Key Debugging Strategy

When troubleshooting Zeek:

1. Verify PCAP integrity  
2. Validate script syntax  
3. Confirm script execution  
4. Inspect notice.log  
5. Check thresholds  
6. Analyze conn.log manually  

---

# ðŸ§  Final Reminder

Zeek troubleshooting requires checking:

- Interface configuration
- Traffic generation
- Script thresholds
- Log generation location
- Script loading order

Most issues are caused by:
âœ” Incorrect working directory  
âœ” Wrong interface  
âœ” No traffic in PCAP  
âœ” Threshold values too high  

---

## âœ… Lab Verified

After troubleshooting:

âœ” Zeek installed successfully  
âœ” PCAP processed  
âœ” Custom scripts executed  
âœ” NOTICE alerts generated  
âœ” Analysis scripts validated  
âœ” Security report created  

Lab 19 environment confirmed fully functional.
