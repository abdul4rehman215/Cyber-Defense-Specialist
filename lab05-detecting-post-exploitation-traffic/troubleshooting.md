# üõ†Ô∏è Troubleshooting ‚Äì Lab 5: Detecting Post-Exploitation Traffic

<br>

### Issue 1: Permission Denied When Running tcpdump
#### Problem
`tcpdump: lo: You don't have permission to capture on that device
(socket: Operation not permitted)
`
#### Cause
 User does not have packet capture permissions.

#### Solution

Add user to appropriate group or use sudo.
```
sudo usermod -a -G wireshark $USER
```

Log out and back in, or run:
```
newgrp wireshark
```

Alternatively:
```
sudo tcpdump -i lo -w capture.pcap
```
### Issue 2: Wireshark Does Not Launch
#### Problem
`
Wireshark GUI fails to open or displays graphical errors.
`
#### Solutions

Install Wireshark if missing:
```
sudo apt update
sudo apt install wireshark
````

Check display variable (if SSH or remote session):
```
echo $DISPLAY
export DISPLAY=:0
```

If running headless, analyze with tshark instead:
```
tshark -r c2_traffic.pcap
```
### Issue 3: Python Script Errors
#### Problem
`
ModuleNotFoundError
Permission denied
`
#### Solutions

Ensure Python 3 is installed:
```
python3 --version
```

Install required packages:
```
sudo apt install python3-pip
pip3 install requests
```
Make scripts executable:
```
chmod +x script_name.py
```

Run explicitly with Python:
```
python3 script_name.py
```
### Issue 4: No Traffic Captured in PCAP File
#### Problem
`
PCAP file is empty or very small.
`
#### Causes

- Wrong interface selected
- No traffic generated during capture
- Capture stopped too early

#### Solutions

Check available interfaces:
```
ip addr show
```

Capture on any interface:
```
sudo tcpdump -i any -w capture.pcap
```

Ensure traffic runs while capture is active:
```
sudo tcpdump -i lo -w test.pcap &
python3 simulate_script.py
sleep 10
sudo kill $!
```

Verify file size:
```
ls -lh capture.pcap
```
### Issue 5: Port Already in Use
#### Problem
`
OSError: [Errno 98] Address already in use
`
#### Cause

Previous simulation server still running.

#### Solution

Find process using port:
```
sudo lsof -i :8080
sudo lsof -i :4444
```

Kill process:
```
kill <PID>
```

Or free port:
```
sudo fuser -k 8080/tcp
```
### Issue 6: tcpdump Capture Stops Unexpectedly
#### Cause
```
Timeout, resource limits, or manual interruption.
```
#### Solution

Check system logs:
```
dmesg | tail
````

Run with verbose mode:
```
sudo tcpdump -i lo -vv
```

Ensure enough disk space:
```
df -h
```
### Issue 7: C2 Detection Script Fails
#### Problem
`
FileNotFoundError: lateral_movement.pcap not found
`
#### Solution

Ensure capture files exist:
```
ls -la *.pcap
```

Verify correct file names in script:
```
nano c2_detector.py
```

Confirm tcpdump binary path:
```
which tcpdump
```
### Issue 8: Comprehensive Scenario Capture Not Created
#### Cause
`
sudo permissions required inside Python subprocess.
`
#### Solution

Run script with sudo:
```
sudo python3 comprehensive_scenario.py
```
Or modify script to remove sudo and run capture separately.

## Verification Checklist After Troubleshooting

- ‚úî tcpdump captures packets successfully
- ‚úî lateral_movement.pcap created and contains traffic
- ‚úî c2_traffic.pcap created and contains HTTP + port 4444 traffic
- ‚úî Wireshark opens capture files correctly
- ‚úî c2_detector.py runs without errors
- ‚úî Risk classification outputs LOW / MEDIUM / HIGH properly
