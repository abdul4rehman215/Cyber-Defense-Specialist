#!/usr/bin/env python3
import socket
import time
import threading

def simulate_smb_scanning():
    """Simulate SMB port scanning across internal network"""
    print("[+] Simulating SMB scanning...")
    internal_ips = ["192.168.1.10", "192.168.1.11", "192.168.1.12", "192.168.1.13"]

    for ip in internal_ips:
        try:
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            sock.settimeout(1)
            sock.connect_ex((ip, 445))
            sock.close()
            time.sleep(0.5)
        except:
            pass

def simulate_rdp_attempts():
    """Simulate RDP connection attempts"""
    print("[+] Simulating RDP connection attempts...")
    targets = ["192.168.1.15", "192.168.1.16", "192.168.1.17"]

    for target in targets:
        try:
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            sock.settimeout(2)
            sock.connect_ex((target, 3389))
            sock.close()
            time.sleep(1)
        except:
            pass

def simulate_wmi_activity():
    """Simulate WMI-like network activity"""
    print("[+] Simulating WMI activity...")
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.bind(('localhost', 0))
        port = sock.getsockname()[1]
        sock.listen(1)
        print(f"[+] WMI listener on port {port}")
        sock.settimeout(5)
        try:
            conn, addr = sock.accept()
            conn.close()
        except:
            pass
        sock.close()
    except:
        pass

def main():
    print("=== Lateral Movement Traffic Simulation ===")

    threads = []
    t1 = threading.Thread(target=simulate_smb_scanning)
    t2 = threading.Thread(target=simulate_rdp_attempts)
    t3 = threading.Thread(target=simulate_wmi_activity)

    threads.extend([t1, t2, t3])

    for thread in threads:
        thread.start()
        time.sleep(2)

    for thread in threads:
        thread.join()

    print("[+] Lateral movement simulation complete")

if __name__ == "__main__":
    main()
