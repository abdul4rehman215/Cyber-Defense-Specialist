# ğŸ§ª Lab 5: Detecting Post-Exploitation Traffic

## ğŸ–¥ï¸ Environment
- OS: Ubuntu 22.04 LTS  
- User: toor  
- Host: ip-172-31-10-241  
- Interface Used: lo (Loopback â€“ controlled simulation)

---

## ğŸ¯ Objectives

- Identify lateral movement traffic
- Detect post-exploitation behaviors
- Capture and analyze suspicious network activity
- Simulate and detect Command-and-Control (C2) communication
- Build automated detection logic for threat hunting

---

## ğŸ§  Skills Demonstrated

- SMB & RDP traffic analysis (Ports 445, 3389)
- Internal scanning detection
- Beaconing pattern identification
- Base64 payload recognition
- Detection of non-standard C2 ports (4444)
- Automated PCAP analysis scripting
- Wireshark behavioral investigation
- Risk classification logic implementation

---

## ğŸ§© Tasks Performed

### 1ï¸âƒ£ Lateral Movement Simulation
- Generated simulated SMB scanning
- Simulated RDP connection attempts
- Simulated WMI-style internal activity
- Captured traffic using tcpdump
- Analyzed connection patterns and SYN behavior

### 2ï¸âƒ£ Command-and-Control (C2) Simulation
- Generated HTTP-based beacon traffic
- Simulated encrypted C2 over port 4444
- Created Base64-encoded command payloads
- Captured C2 traffic for analysis

### 3ï¸âƒ£ Automated C2 Detection
- Built PCAP parsing script
- Detected beacon intervals
- Identified unusual ports
- Detected Base64-encoded traffic
- Calculated risk score classification

### 4ï¸âƒ£ Comprehensive Attack Scenario
- Combined lateral movement + C2 phases
- Captured full attack chain
- Validated detection logic against multi-stage activity

---

## ğŸ” Key Findings

- Repeated SMB/RDP SYN attempts indicate lateral movement.
- Regular HTTP GET intervals indicate beaconing.
- Base64 responses strongly indicate C2 communication.
- Port 4444 traffic classified as high-risk.
- Automated detection logic correctly identified medium vs high risk scenarios.

---

## ğŸ“Š Risk Classification Results

| PCAP File | Risk Level | Indicators |
|-----------|------------|------------|
| lateral_movement.pcap | MEDIUM | SMB/RDP scanning |
| c2_traffic.pcap | HIGH | Beaconing + Base64 + Unusual Port |
| comprehensive_attack.pcap | HIGH | Multi-stage attack chain |

---

## ğŸ¯ Why This Lab Matters

Post-exploitation detection is critical because attackers already have access at this stage.

Early detection enables:
- Containment before privilege escalation
- Disruption of attacker C2 channels
- Prevention of domain-wide compromise
- Improved SOC detection engineering

---

## ğŸš€ Real-World SOC Relevance

This lab mirrors real blue-team investigations:

- Detecting internal reconnaissance
- Identifying C2 communication patterns
- Behavioral anomaly detection
- Automated PCAP threat scoring
- Threat hunting workflow preparation

---

## âœ… Final Status

âœ” Lateral movement successfully simulated  
âœ” C2 beaconing detected  
âœ” Base64 payloads identified  
âœ” Non-standard port detection validated  
âœ” Automated detection script functional  
âœ” Full attack chain captured and analyzed  
