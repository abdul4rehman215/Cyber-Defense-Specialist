#!/bin/bash
# Lab 08 – Malware Identification in Document Payloads
# Commands Executed During Lab

# --------------------------------------------------
# Task 1: Environment Verification & Setup
# --------------------------------------------------

python3 --version

pip3 install --upgrade pip

pip3 install oletools python-magic pdfplumber docx2txt psutil

sudo apt install firejail libmagic1 -y

mkdir -p ~/malware_analysis/{samples,scripts,results,logs}

cd ~/malware_analysis
pwd

cd samples

nano suspicious_test.txt

ls -lh


# --------------------------------------------------
# Task 2: Build Document Scanner
# --------------------------------------------------

cd ../scripts

nano document_scanner.py

nano batch_scanner.py

chmod +x document_scanner.py batch_scanner.py


# --------------------------------------------------
# Static Scan – Single File
# --------------------------------------------------

python3 document_scanner.py ../samples/suspicious_test.txt


# --------------------------------------------------
# Batch Scan
# --------------------------------------------------

python3 batch_scanner.py ../samples/


# --------------------------------------------------
# Task 3: Sandboxed Analysis
# --------------------------------------------------

mkdir -p ~/.config/firejail

nano ~/.config/firejail/document-analysis.profile

nano sandboxed_analyzer.py

nano dynamic_monitor.py

chmod +x sandboxed_analyzer.py dynamic_monitor.py


# --------------------------------------------------
# Test Sandboxed Execution
# --------------------------------------------------

python3 sandboxed_analyzer.py ../samples/suspicious_test.txt


# --------------------------------------------------
# Test Dynamic Monitoring
# --------------------------------------------------

python3 dynamic_monitor.py "python3 document_scanner.py ../samples/suspicious_test.txt" 30


# --------------------------------------------------
# Review Generated Reports
# --------------------------------------------------

ls -lh ../results/


# --------------------------------------------------
# Task 4: Pattern-Based Detection
# --------------------------------------------------

nano pattern_analyzer.py

nano obfuscated_test.txt

python3 pattern_analyzer.py ../samples/obfuscated_test.txt
