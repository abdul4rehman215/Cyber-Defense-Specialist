# ğŸ›  Troubleshooting Guide â€“ Lab 08  
## Malware Identification in Document Payloads

---

## ğŸ”´ Issue 1: Permission Denied When Executing Scripts

### ğŸ” Symptoms
- `Permission denied`
- Script not executing after creation

### ğŸ§  Cause
The script does not have executable permissions.

### âœ… Solution

Check file permissions:

```bash
ls -l script_name.py
```

Add execute permission:

```bash
chmod +x script_name.py
```

If directory permissions are incorrect:

```bash
chmod -R 755 ~/malware_analysis
```

---

## ğŸ”´ Issue 2: Python Module Import Errors

### ğŸ” Symptoms
- `ModuleNotFoundError`
- `ImportError`
- Script crashes during execution

### ğŸ§  Cause
Required Python packages are not installed or installed in a different environment.

### âœ… Solution

Verify installed packages:

```bash
pip3 list
```

Reinstall required modules:

```bash
pip3 install --upgrade oletools python-magic pdfplumber psutil docx2txt
```

Verify Python version:

```bash
which python3
python3 --version
```

Ensure pip and python point to same interpreter.

---

## ğŸ”´ Issue 3: python-magic Not Detecting MIME Type Properly

### ğŸ” Symptoms
- MIME type shows incorrect value
- MIME detection returns generic type

### ğŸ§  Cause
System dependency `libmagic1` is missing.

### âœ… Solution

Install required library:

```bash
sudo apt install libmagic1 -y
```

Verify installation:

```bash
file suspicious_test.txt
```

---

## ğŸ”´ Issue 4: Firejail Sandbox Not Working

### ğŸ” Symptoms
- `firejail: command not found`
- Sandbox execution fails
- Profile not applied

### ğŸ§  Cause
Firejail is not installed or profile file missing.

### âœ… Solution

Verify installation:

```bash
which firejail
```

If not installed:

```bash
sudo apt install firejail -y
```

Verify profile file:

```bash
ls ~/.config/firejail/
```

Test Firejail independently:

```bash
firejail --noprofile ls
```

If profile errors occur, validate profile syntax.

---

## ğŸ”´ Issue 5: No Macros Detected in Office Documents

### ğŸ” Symptoms
- Macro analysis shows `macros_detected: False`
- Risk score remains low

### ğŸ§  Cause
- File is not macro-enabled
- MIME type misidentified
- Oletools not functioning properly

### âœ… Solution

Ensure document type supports macros:

- `.docm`
- `.xlsm`

Verify MIME detection:

```bash
file suspicious_document.docm
```

Test oletools manually:

```bash
olevba suspicious_document.docm
```

---

## ğŸ”´ Issue 6: Dynamic Monitor Not Detecting Processes

### ğŸ” Symptoms
- No new processes detected
- Empty `new_processes` list

### ğŸ§  Cause
- Document did not spawn new processes
- Monitoring duration too short
- Insufficient privileges

### âœ… Solution

Increase monitoring duration:

```bash
python3 dynamic_monitor.py "<command>" 60
```

Run with elevated privileges if needed:

```bash
sudo python3 dynamic_monitor.py "<command>" 60
```

---

## ğŸ”´ Issue 7: Timeout During Sandboxed Execution

### ğŸ” Symptoms
- `Analysis timed out`

### ğŸ§  Cause
The analysis exceeded the timeout limit (300 seconds).

### âœ… Solution

Modify timeout value inside:

```python
timeout=300
```

Increase to:

```python
timeout=600
```

Or inspect the document manually for heavy processing.

---

## ğŸ”´ Issue 8: JSON Reports Not Generated

### ğŸ” Symptoms
- No output files inside results directory
- FileNotFoundError

### ğŸ§  Cause
- Incorrect directory path
- Results directory missing

### âœ… Solution

Verify directory exists:

```bash
ls ~/malware_analysis/results
```

If missing:

```bash
mkdir -p ~/malware_analysis/results
```

Check write permissions:

```bash
chmod 755 ~/malware_analysis/results
```

---

## ğŸ”´ Issue 9: Pattern Analyzer Not Detecting Obfuscation

### ğŸ” Symptoms
- Obfuscated strings not detected

### ğŸ§  Cause
Regex patterns may not match variation of obfuscation.

### âœ… Solution

Verify test content:

```bash
cat obfuscated_test.txt
```

Ensure patterns match format:

```regex
Chr\(\d+\)
```

Modify regex for extended coverage if needed.

---

## ğŸ”´ Issue 10: Network Connections Not Showing in Dynamic Monitor

### ğŸ” Symptoms
- `network_connections` list empty

### ğŸ§  Cause
- Network disabled in sandbox
- No active external connections
- Firejail profile blocking network

### âœ… Solution

Verify sandbox profile contains:

```
net none
```

If testing network behavior, temporarily modify profile.

---

# ğŸ›¡ Best Practice Recommendations

- Always analyze suspicious files in isolated environments.
- Never execute unknown documents directly on production systems.
- Combine static and dynamic analysis for accurate detection.
- Automate repetitive detection workflows.
- Generate structured reports for documentation and compliance.

---

# âœ… Lab Validation Checklist

- âœ” Python modules installed  
- âœ” Hash calculation working  
- âœ” MIME detection working  
- âœ” Macro detection validated  
- âœ” Batch scanning operational  
- âœ” Firejail sandbox configured  
- âœ” Dynamic monitoring operational  
- âœ” Pattern detection validated  
- âœ” JSON reports generated successfully  
